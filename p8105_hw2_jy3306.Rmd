---
title: "p8105_HW2"
author: "John Yang"
date: "2024-10-02"
output: github_document
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(dplyr)
library(readxl)
```

## Problem 1

### Reading and cleaning the data

```{r}
sub_df =
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", 
           na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  select(line, station_name, station_latitude, station_longitude,
         route1, route2, route3, route4, route5, route6, route7,
         route8, route9, route10, route11,
         entry, entrance_type, vending, ada) |> 
  mutate(
    entry = case_match(
      entry,
      "YES" ~ 1,
      "NO" ~ 0,
    )
  )
```

### Description of Dataset

The dataset "sub_df" consists of NYC transit subway lines, stations, and the descriptions of station characteritsics, such as location, entry, entrance type, vending, and ADA compliance. The following are the key variables:

  * `line` is a categorical variable describing the NYC transit subway lines.
  * `station_name`is a categorical variable describing the name of the station.
  * `station_latitude` is a continuous variable describing the latitude of the station in degrees.
  * `station_longitude` is a continuous variable describing the longitude of the station in degrees.
  * `route1`-`route11` are categorical variables describing the subway routes that stop at the station.
  * `entry`is a logical variable variable describing the whether there is an entry to the station. 
  * `entry_type`is categorical variables describing the entry types of the station. 
  * `vending` is a categorical variable whether there is vending or not in the station.
  * `ada`is a categorical describing whether there is ADA compliance in the station.

The dataset was cleaned, first, using the `janitor` function to convert the variable names to lowercase and replace spaces with "_". Then, variables of interests were selected. Then the entry variable was converted from character to a logical variable using the `mutate` function. The resulting dataset contains **`r nrow(sub_df)`** rows and **`r ncol(sub_df)`** columns. This data is tidy.

There are `r nrow(distinct(sub_df, line, station_name))` distinct stations in this dataset. 

There are `r nrow(distinct(filter(sub_df, ada == TRUE), line, station_name))` stations that are ADA compliant.

The proportion of station entrances / exits without vending allowing entrance is `r nrow(filter(sub_df, entry == 1 & vending == "NO")) / nrow(filter(sub_df, vending == "NO"))`.


Reformatting data so that that route number and route name are distinct variables. 

```{r}
sub_new_df = 
  sub_df |> 
  mutate(across(starts_with("route"), as.character)) |> 
  pivot_longer(
    cols = route1:route11,
    names_to = "routes_number",
    values_to = "route"
  )
```

There are `r nrow(distinct(filter(sub_new_df, route == "A", na.rm = TRUE), line, station_name))` distinct stations that serve the A train. 

Of the stations that serve the A train, `r nrow(distinct(filter(sub_new_df, route == "A" & ada == "TRUE", na.rm = TRUE), line, station_name))` are ADA compliant.

## Problem 2


### Reading and cleaning Mr. Trash Wheel dataset

```{r}
mr_df = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", 
             sheet = "Mr. Trash Wheel",
             range = "A2:N653",
             na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  rename(
    weight = "weight_tons",
    volume = "volume_cubic_yards") |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)), 
    trash_wheel = "mr",
    year = as.numeric(year)
    ) |> 
  relocate(trash_wheel)
```


### Reading and cleaning Professor Trash Wheel dataset

```{r}
prof_df = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", 
             sheet = "Professor Trash Wheel",
             range = "A2:M118",
             na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  rename(
    weight = "weight_tons",
    volume = "volume_cubic_yards") |> 
  mutate(
    trash_wheel = "professor", 
    year = as.numeric(year)
    ) |> 
  relocate(trash_wheel)
```

### Reading and cleaning Gwynnda Trash Wheel dataset

```{r}
gwynnda_df = 
  read_excel("data/202409 Trash Wheel Collection Data.xlsx", 
             sheet = "Gwynnda Trash Wheel",
             range = "A2:L265",
             na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  rename(
    weight = "weight_tons",
    volume = "volume_cubic_yards")|> 
  mutate(
    trash_wheel = "gwynnda",
    year = as.numeric(year)
    )|> 
  relocate(trash_wheel)
```


### Combining Trash Wheel datasets

```{r}
trash_wheel_df = 
  full_join (mr_df, prof_df) |> 
  full_join (x = _, y = gwynnda_df)
```


